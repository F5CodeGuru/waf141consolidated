<!DOCTYPE html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Exercise 1.1: Policy Creation &#8212; WAF141 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Exercise 1.3: Bot Defense" href="../lab2/lab2.html" />
    <link rel="prev" title="Module 1: Base Policy Creation" href="../module1.html" />
<!--
# Copyright 2017 F5 Networks
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-->
<link href="https://cdn.f5.com/favicon.ico" rel="icon">
<script src="https://use.fontawesome.com/21fb8a09c3.js"></script>
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head><body>
  <div class="container-fluid">
  <div class="row corp-header">
    <div class="container corp-header">
      <div class="container corp-menu">
        <ul>
          <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
          <li><a href="https://support.f5.com">Support</a></li>
          <li><a href="https://devcentral.f5.com">Community</a></li>
          <li><a href="https://github.com/F5Networks">GitHub</a></li>
          <li><a href="https://f5.com/about-us/careers">Careers</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row pageHeader">
    <div class="container stat">
      <div class="col-xs-12 stat">
        <a class="internalLink" href="https://f5.com">
          <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44" alt="F5 Networks" title="F5 Networks" border="0">
        </a>
        <ul id="MainMenu" class="main-menu">
          <li>
            <a href="#">Products
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>

            <div class="menu-panel soft-hide" id="ProductsSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                  <li class="third"><span class="a-mm-h">BIG-IP Controllers</span>
                    <ul>
                      <li><a href="/products/connectors/cf-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Cloud Foundry</a></li>
                      <li><a href="/products/connectors/k8s-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Kubernetes/OpenShift</a></li>
                      <li><a href="/products/connectors/marathon-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Marathon</a></li>
                    </ul>
                    <!-- unnecessary right now, we have them all listed>
                      <span class="seemore"><a data-link-type="Nav: Mega" href="/products/connectors">See all </a></span><-->
                    <span class="a-mm-h">Application Services Proxy</span>
                    <ul>
                      <li><a href="/products/asp/latest" data-link-type="Nav: Mega">F5 Application Services Proxy</a></li>
                      <li><a href="/products/connectors/f5-kube-proxy/latest" data-link-type="Nav: Mega">F5-kube-proxy</a></li>
                      <li><a href="/products/connectors/marathon-asp-ctlr/latest" data-link-type="Nav: Mega">F5 ASP Controller for Marathon</a></li>
                    </ul>
                    <!-- unnecessary>
                    <span class="seemore"><a href="/products/asp/latest">See all </a></span>
                    --->
                  </li>
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">OpenStack</span>
                    <ul>
                      <li><a href="/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack Neutron</a></li>
                      <li><a href="/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver - OpenStack LBaaS</a></li>
                      <li><a href="/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins - OpenStack Heat</a></li>
                     </ul>
                    <!--
                    <span class="seemore"><a href="/products/index.html">See all </a></span>
                    --->
                  </li>
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">Orchestration Templates</span>
                  <ul>
                    <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank">F5 Templates for AWS CloudFormation</a> </li>
                    <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank">F5 Templates for Azure ARM</a> </li>
                    <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank">F5 Templates for Google Cloud Deployment Manager</a> </li>
                    <li><a href="/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates for OpenStack Heat</a></li>
                  </ul>
                    <!--
                    <span class="seemore"><a href="/products/index.html">See all </a></span>
                    --->
                </ul>
              </div>
            </div>
          </li>
          <li>
            <a href="#">Cloud & Container Integrations
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>

            <div class="menu-panel soft-hide" id="ContainersSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                    <!--- HIDE, ALL ARE CURRENTLY DISPLAYED>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/containers/latest/">See all </a></span>
                    --->
                  <li class="third"><span class="a-mm-h">Clouds</span>
                    <ul>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">AWS</a></li>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">Azure</a></li>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">Google Cloud</a></li>
                      <li><a href="/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                    </ul>
                    <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">Containers</span>
                    <ul>
                      <li><a href="/containers/latest/cloudfoundry/" data-link-type="Nav: Mega">Cloud Foundry</a> </li>
                      <li><a href="/containers/latest/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a></li>
                      <li><a href="/containers/latest/marathon/" data-link-type="Nav: Mega">Mesos Marathon</a></li>
                      <li><a href="/containers/latest/openshift/" data-link-type="Nav: Mega">OpenShift</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </li>
          <li>
            <a href="#">Resources
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>
            <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                  <li class="third">
                    <span class="a-mm-h">Downloads</span>
                    <ul>
                      <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/" class="internalLink">Docker Hub</a></li>
                      <li><a target="_blank" data-link-type="Nav: Mega" href="https://store.docker.com/images/f5networks-asp" class="internalLink">Docker Store</a></li>
                    </ul>
                    <span class="a-mm-h">OpenSource</span>
                  <ul>
                    <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks" class="internalLink">F5Networks on GitHub</a></li>
                    <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral" class="internalLink">F5DevCentral on GitHub</a></li>
                  </ul>
                    </li>
                  <li class="divider"></li>
                  <li class="third">
                  <span class="a-mm-h">Training & Labs</span>
                   <ul>
                  <li><p>Learn how to get the most out of the F5 platform</p></li>
                    <li><a href="/training/community">Community</a></li>
                  </ul>
                  </li>
                  <li class="divider"></li>
                  
                  <li class="third">
                    <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank" data-link-type="Nav: Mega">F5 University</a>
                    <ul>
                      <li>
                        <p>Get up to speed with free self-paced courses</p>
                      </li>
                    </ul>
                    <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank" data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                    <ul>
                      <li>
                        <p>Join the community of 250,000+ technical peers</p>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div> <!-- /container-fluid -->

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-3 sidebartoc">
         <h4><a href="../../">WAF141 1.0</a></h4>
  <p class="caption">
   <span class="caption-text">Current Page</span>
  </p>
  <ul>
<li><a class="reference internal" href="#">Exercise 1.1: Policy Creation</a><ul>
<li><a class="reference internal" href="#objective">Objective</a></li>
<li><a class="reference internal" href="#create-your-1st-waf-policy">Create Your 1st WAF Policy</a></li>
<li><a class="reference internal" href="#verify-waf-profile-is-applied-to-virtual-server">Verify WAF Profile is Applied to Virtual Server</a></li>
<li><a class="reference internal" href="#create-application-security-logging-profile">Create Application Security Logging Profile</a></li>
<li><a class="reference internal" href="#apply-waf-logging-profile">Apply WAF Logging Profile</a></li>
<li><a class="reference internal" href="#test-waf-policy">Test WAF Policy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-1-2-geolocation-and-ip-intelligence">Exercise 1.2: Geolocation and IP Intelligence</a><ul>
<li><a class="reference internal" href="#geolocation">Geolocation</a></li>
<li><a class="reference internal" href="#ip-reputation">IP Reputation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../module1.html"
                        title="previous chapter">Module 1: Base Policy Creation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../lab2/lab2.html"
                        title="next chapter">Exercise 1.3: Bot Defense</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/module1/lab1/lab1.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <form class="search" action="../../search.html" method="get">
    <div>
      <input type="text" name="q" placeholder="Search" style="padding-left: 6px;"/>
      <!-- <input type="submit" value="Go" style="margin-top: 4px;"/> -->
      <button type="submit" class="btn btn-primary btn-xs">Go</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        
      </div>
      <div class="col-md-offset-3 col-sm-offset-3 main">
        <h4>
          <a href="/">Cloud Docs Home</a> &gt; <a href="../../index.html">WAF141</a>
          <span class="right"><a href="../../genindex.html">Index</a></span>
        </h4>
        
  <div class="section" id="exercise-1-1-policy-creation">
<h1>Exercise 1.1: Policy Creation<a class="headerlink" href="#exercise-1-1-policy-creation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Create a transparent rapid deployment policy.</li>
<li>Enable application security logging profile.</li>
<li>Validate that both the policy and logging profile are working.</li>
<li>Configure Geolocation and review logs</li>
<li>Configure IP Intelligence and review logs</li>
<li>Estimated time for completion: <strong>30</strong> <strong>minutes</strong>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the Operating system prompts you to update system software, please decline</p>
</div>
<ol class="arabic simple">
<li>RDP to client01, launch Chrome (please be patient and don’t click the icon multiple times. Chrome can take a few seconds to launch), click the BIG-IP bookmark and login to TMUI. admin/&lt;password&gt;. You may have to click Proceed to bypass a untrusted certicate.</li>
<li>Open a terminal, cd to the waf141 folder</li>
<li>Then run the below to create the 4 virtuals used in this lab. Ignore any warnings about certificates.</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 prepare141Lab.py
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/prepare141.png"><img alt="../../_images/prepare141.png" src="../../_images/prepare141.png" style="width: 600px;" /></a>
<p>Please ensure that four virtual servers are configured before you begin:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_overlay_vs</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_http_vs</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">automation_vs</span></code></li>
</ul>
</div>
<div class="section" id="create-your-1st-waf-policy">
<h2>Create Your 1st WAF Policy<a class="headerlink" href="#create-your-1st-waf-policy" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>On the Main tab, click <strong>Security &gt; Application Security &gt; Security Policies</strong>. The Active Policies screen opens.</li>
<li>Click on the <strong>Polices List</strong></li>
</ol>
<a class="reference internal image-reference" href="../../_images/image1.PNG"><img alt="../../_images/image1.PNG" src="../../_images/image1.PNG" style="width: 600px;" /></a>
<ol class="arabic simple">
<li>Click on the <strong>Create New Policy</strong> button. The policy creation wizard opens.</li>
<li>Click on the <strong>Advanced</strong> button (Top-Right) to ensure that all the available policy creation options are displayed.</li>
<li>Name the security policy <code class="docutils literal notranslate"><span class="pre">lab1_webgoat_waf</span></code> and notice that the <strong>Policy Type</strong> is security.</li>
<li>Verify the <strong>Policy Template</strong> is set to <code class="docutils literal notranslate"><span class="pre">Rapid</span> <span class="pre">Deployment</span> <span class="pre">Policy</span></code> and notice it is a transparent security policy by default</li>
<li>Assign this policy to the <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> from the Virtual Server drop down.</li>
<li>Confirm that the Application Language is set to <strong>UTF-8</strong>.</li>
<li>Accept the remaining default policy settings and click <strong>Create Policy</strong> to complete the policy creation process.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After policy creation is complete, the properties will be displayed for review within the Policies List menu.</p>
</div>
<p><strong>Your settings should reflect the figures below:</strong></p>
<a class="reference internal image-reference" href="../../_images/module1Lab1Excercise1-image1.png"><img alt="../../_images/module1Lab1Excercise1-image1.png" src="../../_images/module1Lab1Excercise1-image1.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>The resulting policy</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/imagefix.PNG"><img alt="../../_images/imagefix.PNG" src="../../_images/imagefix.PNG" style="width: 600px;" /></a>
</div>
<div class="section" id="verify-waf-profile-is-applied-to-virtual-server">
<h2>Verify WAF Profile is Applied to Virtual Server<a class="headerlink" href="#verify-waf-profile-is-applied-to-virtual-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>In the configuration utility navigate to <strong>Local Traffic &gt; Virtual Servers</strong>, click on <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code>.</li>
<li>Click on <strong>Policies</strong> under the <strong>Security</strong> tab at the top of the <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> details menu.</li>
<li>In the <strong>Application Security Policy</strong> drop down menu, ensure <strong>Application Security Policy</strong> is <code class="docutils literal notranslate"><span class="pre">Enabled...</span></code> and the <strong>Policy:</strong> drop-down selection shows the <code class="docutils literal notranslate"><span class="pre">lab1_webgoat_waf</span></code> policy.</li>
<li>Notice Log Profile is set to <code class="docutils literal notranslate"><span class="pre">Disabled</span></code>.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image4.PNG"><img alt="../../_images/image4.PNG" src="../../_images/image4.PNG" style="width: 600px;" /></a>
</div>
<div class="section" id="create-application-security-logging-profile">
<h2>Create Application Security Logging Profile<a class="headerlink" href="#create-application-security-logging-profile" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>In the configuration utility navigate to <strong>Security &gt; Event Logs &gt; Logging Profiles</strong> then click on the <strong>plus</strong> icon.</li>
<li>Under the <strong>Logging Profile Properties</strong> section enter a <strong>Profile Name</strong> <code class="docutils literal notranslate"><span class="pre">waf_allrequests</span></code>, select the checkbox for <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code>.</li>
<li>Change the <strong>Configuration</strong> dropdown to <code class="docutils literal notranslate"><span class="pre">Advanced</span></code> under the <strong>Application Security</strong> section.</li>
<li>Select the <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Storage</span></code> value for the <strong>Storage Destination</strong> configuration option.</li>
<li>Select the <code class="docutils literal notranslate"><span class="pre">For</span> <span class="pre">all</span> <span class="pre">Requests</span></code> value for the <strong>Response Logging</strong> configuration option.</li>
<li>Select the <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">requests</span></code> value for the <strong>Request Type</strong> configuration option.</li>
<li>Click <strong>Create.</strong></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/module1Lab1Excercise1-image7.png"><img alt="../../_images/module1Lab1Excercise1-image7.png" src="../../_images/module1Lab1Excercise1-image7.png" style="width: 600px;" /></a>
</div></blockquote>
<p><strong>Question:</strong> Would logging all requests and responses in a production environment be a best practice?</p>
<p><strong>Answer:</strong> This adds 50% or more to the overhead on the log engine and would not typically be used outside of troubleshooting or high security environments that are appropriately sized.</p>
</div>
<div class="section" id="apply-waf-logging-profile">
<h2>Apply WAF Logging Profile<a class="headerlink" href="#apply-waf-logging-profile" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Under <strong>Local Traffic &gt; Virtual Servers</strong>, click on <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code>.</li>
<li>Click on <strong>Policies</strong> under the <strong>Security</strong> tab at the top of the <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> details menu.</li>
<li>In the <strong>Log Profile</strong> drop down menu, select <code class="docutils literal notranslate"><span class="pre">Enabled...</span></code></li>
<li>Within the <strong>Available</strong> logging profiles menu, select <code class="docutils literal notranslate"><span class="pre">waf_allrequests</span></code> and then click the <strong>&lt;&lt;</strong> arrows to move the logging policy to the <strong>Selected</strong> profile.</li>
<li>Click on the Update button to apply the policy.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image6.PNG"><img alt="../../_images/image6.PNG" src="../../_images/image6.PNG" style="width: 600px;" /></a>
</div>
<div class="section" id="test-waf-policy">
<h2>Test WAF Policy<a class="headerlink" href="#test-waf-policy" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open the Google Chrome browser and navigate to <code class="docutils literal notranslate"><span class="pre">https://webgoat.f5.demo/WebGoat/login</span></code> You’ll find a toolbar shortcut for the webgoat link.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image7.PNG"><img alt="../../_images/image7.PNG" src="../../_images/image7.PNG" style="width: 600px;" /></a>
<ol class="arabic simple" start="2">
<li>Login using <strong>f5student/password</strong> credentials and interact with the webgoat application by browsing. Please refrain from experimenting with the site using any familiar “exploit” techniques.</li>
<li>On the BIG-IP, navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong>.</li>
<li>Verify that requests are being logged by the WAF. You should be able to see both the raw client requests and server responses.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/image9.PNG"><img alt="../../_images/image9.PNG" src="../../_images/image9.PNG" style="width: 600px;" /></a>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="exercise-1-2-geolocation-and-ip-intelligence">
<h1>Exercise 1.2: Geolocation and IP Intelligence<a class="headerlink" href="#exercise-1-2-geolocation-and-ip-intelligence" title="Permalink to this headline">¶</a></h1>
<div class="section" id="geolocation">
<h2>Geolocation<a class="headerlink" href="#geolocation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Open <strong>Security &gt; Application Security &gt; Geolocation Enforcement</strong></p>
</li>
<li><p class="first">Select all geolocations <strong>except the United States and N/A</strong> and move
them to Disallowed Geolocations. <strong>Save</strong> and then <strong>Apply Policy</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">N/A covers all RFC1918 addresses. If you aren’t dropping them
at your border router (layer 3), you may decide to geo-enforce at
ASM (Layer 7) if no private IP’s will be accessing the site.</p>
</div>
<a class="reference internal image-reference" href="../../_images/module1Lab1Excercise2-image1.png"><img alt="../../_images/module1Lab1Excercise2-image1.png" src="../../_images/module1Lab1Excercise2-image1.png" style="width: 600px;" /></a>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Remember to click on the <strong>Apply Policy</strong> button (top right) to commit security policy changes.</p>
</div>
</li>
<li><p class="first">Open <strong>Local Traffic &gt; iRules</strong> and open the iRule titled
<code class="docutils literal notranslate"><span class="pre">webgoat_irule</span></code> and review the code.</p>
<div class="highlight-tcl notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">when</span> HTTP_REQUEST <span class="k">{</span>
   <span class="nv">HTTP</span><span class="o">::</span>header replace X-Forwarded-For <span class="s2">&quot;[expr (int(rand()*221)+1)].[expr int(rand()*254)].[expr int(rand()*254)].[expr int(rand()*254)]&quot;</span>
<span class="k">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above iRule is essentially scanning the HTTP headers and when
it finds the <code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code> header it will replace the original source
IP address with a randomized IP address. Since we are only manipulating
the header this has no discernable affect on traffic flow. This iRule
event, <code class="docutils literal notranslate"><span class="pre">when</span> <span class="pre">HTTP_REQUEST</span></code>, also fires before the ASM policy allowing
this “trick” to work to demonstrate a global range of source IP
addresses.</p>
</div>
</li>
<li><p class="first">Open <strong>Local Traffic &gt; Virtual Servers</strong> and click on <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code>. Go to the <strong>Resources</strong>
horizontal tab and click on <strong>Manage</strong> in the <strong>iRules</strong> section.</p>
<a class="reference internal image-reference" href="../../_images/image11.PNG"><img alt="../../_images/image11.PNG" src="../../_images/image11.PNG" style="width: 600px;" /></a>
</li>
<li><p class="first">Select the <code class="docutils literal notranslate"><span class="pre">webgoat_irule</span></code>, move it to the <strong>Enabled</strong> assignment and
click <strong>Finished</strong>.</p>
<a class="reference internal image-reference" href="../../_images/image12.PNG"><img alt="../../_images/image12.PNG" src="../../_images/image12.PNG" style="width: 600px;" /></a>
</li>
</ol>
<p>6. We now need to tell ASM to trust the XFF header by turning on the <strong>Trust XFF Header</strong> feature in the policy.
Navigate to <strong>Application Security &gt; Policy &gt; Policy Properties</strong> and hit the dropdown for <strong>Advanced View</strong>.
You can now set <strong>Trust XFF Header</strong> to <strong>Enabled</strong> and click <strong>Save Changes</strong> then <strong>Apply</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/image15.PNG"><img alt="../../_images/image15.PNG" src="../../_images/image15.PNG" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regarding Trust XFF - you would do this if ASM is deployed behind an internal or other trusted proxy. Then, the system uses the IP address that initiated the connection to the proxy instead of the internal proxy’s IP address. This option is useful for logging, web scraping, anomaly detection, and the geolocation feature.</p>
</div>
<p><strong>You should not configure trusted XFF headers if you think the HTTP header may be spoofed, or crafted, by a malicious client.</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple">
<li>Open a new <strong>Firefox Private</strong> window and connect to
<code class="docutils literal notranslate"><span class="pre">https://webgoat.f5.demo/WebGoat/login</span></code>. Login and select a few links on the WebGoat page.</li>
<li>Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image13.PNG"><img alt="../../_images/image13.PNG" src="../../_images/image13.PNG" style="width: 600px;" /></a>
<p>Notice the geolocation detected and the presence of the X-Forwarded-For (XFF) in the Request details. Your actual client IP is still 10.1.10.28 however, because we trusted the XFF header and the iRule is randomizing the IP address placed in that header so ASM believes the request is from an external location. Depending on your network you may be leveraging a technology that creates a source NAT ahead of ASM. So by leveraging the XFF header, you can work around this and get contextual information about the client.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Please remove the iRule <code class="docutils literal notranslate"><span class="pre">webgoat_irule</span></code> from the
Virtual Server before proceeding.</p>
</div>
</div>
<div class="section" id="ip-reputation">
<h2>IP Reputation<a class="headerlink" href="#ip-reputation" title="Permalink to this headline">¶</a></h2>
<p>Navigate to <strong>Security &gt; Application Security &gt; IP Addresses &gt; IP Intelligence</strong> and click <strong>Enabled</strong>.
For all categories <strong>select Alarm</strong>. Click on <strong>Save</strong> and then on <strong>Apply Policy</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On the top right you should see that your IP Intelligence database has been updated at some point.</p>
</div>
<a class="reference internal image-reference" href="../../_images/image14.PNG"><img alt="../../_images/image14.PNG" src="../../_images/image14.PNG" style="width: 600px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to create traffic with malicious sources for the purposes of this lab we have created another special configuration item for you.</p>
</div>
<p>There is an iRule that you will apply to the <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> virtual server.
This iRule will insert an X-Forward-For header with the value of a malicious United States source IP address. (Remember US is an allowed Geolocation)</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Navigate to <strong>Local Traffic &gt; Virtual Server &gt; Virtual Servers List</strong> and select the</dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> virtual server.</p>
</dd>
</dl>
</li>
<li><p class="first">Navigate to the <strong>Resources</strong> tab and click <strong>Manage</strong> for the <strong>iRules</strong> section.</p>
</li>
<li><p class="first">Move the <strong>ip_rep_irule</strong> irule to the <strong>Enabled</strong> pane of the <strong>Resource Management</strong> configuration and Click <strong>Finished</strong>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/module1Lab1Excercise2-image6.png"><img alt="../../_images/module1Lab1Excercise2-image6.png" src="../../_images/module1Lab1Excercise2-image6.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p class="first">Open a new Private Browsing window in Firefox and enter <a class="reference external" href="https://webgoat.f5.demo/WebGoat/login">https://webgoat.f5.demo/WebGoat/login</a> to browse the site. Login using the f5student:&lt;password provided by instructor&gt; and Click on one or two items. You may need to click Add Exception to bypass an untrusted certificate in Firefox.</p>
</li>
<li><p class="first">Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the log entries. Since you configured IP Intelligence violations to alarm you will not need to change the filter. Select the most recent entry and examine why the request is illegal. What IP address did the request come from?</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/module1Lab1Excercise2-image8.png"><img alt="../../_images/module1Lab1Excercise2-image8.png" src="../../_images/module1Lab1Excercise2-image8.png" style="width: 600px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information click on the violation hyperlink to see the IPI category that this IP belongs to. You can also click “All Details” at the top right.</p>
</div>
<a class="reference internal image-reference" href="../../_images/image24.PNG"><img alt="../../_images/image24.PNG" src="../../_images/image24.PNG" style="width: 600px;" /></a>
</div></blockquote>
</li>
</ol>
<p><strong>Bonus:</strong> You can browse to <code class="docutils literal notranslate"><span class="pre">http://www.brightcloud.com/tools/url-ip-lookup.php</span></code>
and look up the IP address in question for further information. There is also
a tool to report IP addresses that have been incorrectly flagged.</p>
<p>Further, you can ssh to the BIG-IP and login with <code class="docutils literal notranslate"><span class="pre">root</span></code> / <code class="docutils literal notranslate"><span class="pre">password</span></code> to run
the <code class="docutils literal notranslate"><span class="pre">iprep_lookup</span></code> command, similar to:</p>
<p>[<a class="reference external" href="mailto:root&#37;&#52;&#48;bigip1&#46;Active&#46;Standalone">root<span>&#64;</span>bigip1<span>&#46;</span>Active<span>&#46;</span>Standalone</a>] config # <strong>iprep_lookup 8.33.184.254</strong></p>
<p>iprep_lookup 8.33.184.254
opening database in /var/IpRep/F5IpRep.dat
size of IP reputation database = 37026703
iprep threats list for ip = 8.33.184.254 is:
bit 7 - Phishing</p>
</div>
</div>


        
		     <div class="row next-prev-btn-row">
           <div class="col-lg-12">
           
		        <a href="../module1.html" title="Module 1: Base Policy Creation" accesskey="p" class="btn btn-primary pull-left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
           
           
              <a href="../lab2/lab2.html" title="Exercise 1.3: Bot Defense" accesskey="n" class="btn btn-primary pull-right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
           
		     </div>
         </div>
        
      </div>
    </div>
  </div>


      <div class="container-fluid">
      <div class="row">
        <div class="content-fluid pre-footer">
          <div class="blocks-container">
            <div class="block">
              <h3>Support Programs</h3>
              <p>Regionally located support centers enable F5 to provide support in a number of languages through native-speaking support engineers.</p>
              <a class="btn internalLink" data-ng-href="https://f5.com/support/support-offerings" target="_blank" href="https://f5.com/support/support-offerings">See more
                <span class="icon-1x-right icon-new-window" data-icon="new-window">​</span>
              </a>
            </div>
            <div class="block">
              <h3>Contact Support</h3>
              <p>
                North America: 1-888-882-7535<br>
                Outside North America: 800-11-275-435
              </p>
              <a class="btn internalLink" data-ng-href="https://f5.com/about-us/contact#regional-support" target="_blank" href="https://f5.com/about-us/contact#regional-support">Local Support Numbers
                <span class="icon-1x-right icon-new-window" data-icon="new-window">​</span>
              </a>
            </div>
            <div class="block">
              <h3>Feedback and Help</h3>
              <p>Have questions, suggestions, or just want to get something off your chest? Let us know.</p>
              <a class="btn" data-ui-sref="siteFeedback" target="_blank" href="https://support.f5.com/csp/siteFeedback">Leave feedback</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="footer">
          <div class="container">
            <div class="col-sm-3 col-md-2">
              <h4>About F5</h4>
              <ul>
                <li><a data-ng-href="https://f5.com/about-us/contact" target="_blank" data-link-type="footer" href="https://f5.com/about-us/contact" class="internalLink">Contact F5</a>
                </li>
                <li><a data-ng-href="https://f5.com/about-us/careers" target="_blank" data-link-type="footer" href="https://f5.com/about-us/careers" class="internalLink">Careers</a>
                </li>
              </ul>
            </div>
            <div class="col-sm-3 col-md-2">
              <h4>Education</h4>
              <ul>
                <li><a data-ng-href="https://f5.com/education/training" target="_blank" data-link-type="footer" href="https://f5.com/education/training" class="internalLink">Training</a>
                </li>
                <li><a data-ng-href="https://f5.com/education/certification" target="_blank" data-link-type="footer" href="https://f5.com/education/certification" class="internalLink">Certification</a>
                </li>
                <li><a data-ng-href="https://f5.com/education/training/free-courses" target="_blank" data-link-type="footer" href="https://f5.com/education/training/free-courses" class="internalLink">Free Online Training</a>
                </li>
              </ul>
            </div>

            <div class="col-sm-3 col-md-2">
              <h4>F5 sites</h4>
              <ul>
              <li><a data-ng-href="https://f5.com" target="_blank" data-link-type="footer" href="https://f5.com" class="internalLink">F5.com</a>
              </li>
              <li><a data-ng-href="https://devcentral.f5.com" target="_blank" data-link-type="footer" href="https://devcentral.f5.com" class="internalLink">Community</a>
              </li>
              <li><a data-ng-href="https://partners.f5.com" target="_blank" data-link-type="footer" href="https://partners.f5.com" class="internalLink">Partners</a>
              </li>
          </ul>
      </div>

      <div class="col-sm-3 col-md-2">
          <h4>Support Tasks</h4>
          <ul>
              <li><a data-ui-sref="mySupport.createServiceRequest" data-link-type="footer" href="https://support.f5.com/csp/my-support/service-request">Create Service Request </a>
              </li>
              <li><a data-ng-href="https://f5.com/about-us/contact#regional-support" target="_blank" data-link-type="footer" href="https://f5.com/about-us/contact#regional-support" class="internalLink">Contact Support</a>
              </li>
              <li><a data-ui-sref="siteFeedback" target="_blank" data-link-type="footer" href="https://support.f5.com/csp/siteFeedback">Leave feedback [+]</a>
              </li>
          </ul>
      </div>

      <div class="col-xs-12 col-md-3 right">
          <h4>Connect with us</h4>
          <ul class="social_icons">
              <li><a href="//twitter.com/f5networks" target="_blank" data-name="twitter" data-type="" data-prefix="social" data-utf="E032" title="Twitter" class="externalLink"><i class="icon-1x icon-twitter icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.linkedin.com/companies/f5-networks" target="_blank" class="linkedin externalLink" title="LinkedIn"><i class="icon-1x icon-linkedin icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.facebook.com/f5networksinc" target="_blank" class="facebook externalLink" title="Facebook"><i class="icon-1x icon-facebook icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.youtube.com/f5networksinc" target="_blank" class="youtube externalLink" title="YouTube"><i class="icon-1x icon-youtube icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a data-ng-href="https://devcentral.f5.com" target="_blank" class="devcentral internalLink" title="DevCentral" href="https://devcentral.f5.com"><i class="icon-1x icon-dc-pos icon-inverse-circle" data-link-type="footer"></i></a></li>
          </ul>
      </div>

      <div class="content-fluid left">
          <div class="col-xs-12">
              <p>
                  © Copyright <span class="ng-binding">2017</span> by F5 Networks, Inc. |
                  <a data-ng-href="https://f5.com/about-us/policies" target="_blank" data-link-type="footer" href="https://f5.com/about-us/policies" class="internalLink">Policies</a> |
                  <a data-ng-href="https://f5.com/about-us/policies/trademarks" target="_blank" data-link-type="footer" href="https://f5.com/about-us/policies/trademarks" class="internalLink">Trademarks</a>
              </p>
          </div>
      </div>
  </div>
</div>
  </div>
</div>

  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script type="text/javascript">
    jQuery.noConflict(true)
  </script>
  </body>
</html>