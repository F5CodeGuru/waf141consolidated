<!DOCTYPE html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Exercise 2.1: Protocol Compliance &#8212; WAF141 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Module 3: Blocking, Tuning and Attacking the Policy" href="../../module3/module3.html" />
    <link rel="prev" title="Module 2: Transparent Security Policy" href="../module2.html" />
<!--
# Copyright 2017 F5 Networks
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-->
<link href="https://cdn.f5.com/favicon.ico" rel="icon">
<script src="https://use.fontawesome.com/21fb8a09c3.js"></script>
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head><body>
  <div class="container-fluid">
  <div class="row corp-header">
    <div class="container corp-header">
      <div class="container corp-menu">
        <ul>
          <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
          <li><a href="https://support.f5.com">Support</a></li>
          <li><a href="https://devcentral.f5.com">Community</a></li>
          <li><a href="https://github.com/F5Networks">GitHub</a></li>
          <li><a href="https://f5.com/about-us/careers">Careers</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row pageHeader">
    <div class="container stat">
      <div class="col-xs-12 stat">
        <a class="internalLink" href="https://f5.com">
          <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44" alt="F5 Networks" title="F5 Networks" border="0">
        </a>
        <ul id="MainMenu" class="main-menu">
          <li>
            <a href="#">Products
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>

            <div class="menu-panel soft-hide" id="ProductsSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                  <li class="third"><span class="a-mm-h">BIG-IP Controllers</span>
                    <ul>
                      <li><a href="/products/connectors/cf-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Cloud Foundry</a></li>
                      <li><a href="/products/connectors/k8s-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Kubernetes/OpenShift</a></li>
                      <li><a href="/products/connectors/marathon-bigip-ctlr/latest" data-link-type="Nav: Mega">F5 BIG-IP Controller for Marathon</a></li>
                    </ul>
                    <!-- unnecessary right now, we have them all listed>
                      <span class="seemore"><a data-link-type="Nav: Mega" href="/products/connectors">See all </a></span><-->
                    <span class="a-mm-h">Application Services Proxy</span>
                    <ul>
                      <li><a href="/products/asp/latest" data-link-type="Nav: Mega">F5 Application Services Proxy</a></li>
                      <li><a href="/products/connectors/f5-kube-proxy/latest" data-link-type="Nav: Mega">F5-kube-proxy</a></li>
                      <li><a href="/products/connectors/marathon-asp-ctlr/latest" data-link-type="Nav: Mega">F5 ASP Controller for Marathon</a></li>
                    </ul>
                    <!-- unnecessary>
                    <span class="seemore"><a href="/products/asp/latest">See all </a></span>
                    --->
                  </li>
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">OpenStack</span>
                    <ul>
                      <li><a href="/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack Neutron</a></li>
                      <li><a href="/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver - OpenStack LBaaS</a></li>
                      <li><a href="/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins - OpenStack Heat</a></li>
                     </ul>
                    <!--
                    <span class="seemore"><a href="/products/index.html">See all </a></span>
                    --->
                  </li>
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">Orchestration Templates</span>
                  <ul>
                    <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank">F5 Templates for AWS CloudFormation</a> </li>
                    <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank">F5 Templates for Azure ARM</a> </li>
                    <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank">F5 Templates for Google Cloud Deployment Manager</a> </li>
                    <li><a href="/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates for OpenStack Heat</a></li>
                  </ul>
                    <!--
                    <span class="seemore"><a href="/products/index.html">See all </a></span>
                    --->
                </ul>
              </div>
            </div>
          </li>
          <li>
            <a href="#">Cloud & Container Integrations
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>

            <div class="menu-panel soft-hide" id="ContainersSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                    <!--- HIDE, ALL ARE CURRENTLY DISPLAYED>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/containers/latest/">See all </a></span>
                    --->
                  <li class="third"><span class="a-mm-h">Clouds</span>
                    <ul>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">AWS</a></li>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">Azure</a></li>
                      <li><a href="/cloud/public/v1" data-link-type="Nav: Mega">Google Cloud</a></li>
                      <li><a href="/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                    </ul>
                    <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                  <li class="divider"></li>
                  <li class="third"><span class="a-mm-h">Containers</span>
                    <ul>
                      <li><a href="/containers/latest/cloudfoundry/" data-link-type="Nav: Mega">Cloud Foundry</a> </li>
                      <li><a href="/containers/latest/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a></li>
                      <li><a href="/containers/latest/marathon/" data-link-type="Nav: Mega">Mesos Marathon</a></li>
                      <li><a href="/containers/latest/openshift/" data-link-type="Nav: Mega">OpenShift</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </li>
          <li>
            <a href="#">Resources
              <span class="indicator"><span class="arrow-up"></span></span>
            </a>
            <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
              <div class="container">
                <ul class="submenu col-sm-11">
                  <li class="third">
                    <span class="a-mm-h">Downloads</span>
                    <ul>
                      <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/" class="internalLink">Docker Hub</a></li>
                      <li><a target="_blank" data-link-type="Nav: Mega" href="https://store.docker.com/images/f5networks-asp" class="internalLink">Docker Store</a></li>
                    </ul>
                    <span class="a-mm-h">OpenSource</span>
                  <ul>
                    <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks" class="internalLink">F5Networks on GitHub</a></li>
                    <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral" class="internalLink">F5DevCentral on GitHub</a></li>
                  </ul>
                    </li>
                  <li class="divider"></li>
                  <li class="third">
                  <span class="a-mm-h">Training & Labs</span>
                   <ul>
                  <li><p>Learn how to get the most out of the F5 platform</p></li>
                    <li><a href="/training/community">Community</a></li>
                  </ul>
                  </li>
                  <li class="divider"></li>
                  
                  <li class="third">
                    <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank" data-link-type="Nav: Mega">F5 University</a>
                    <ul>
                      <li>
                        <p>Get up to speed with free self-paced courses</p>
                      </li>
                    </ul>
                    <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank" data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                    <ul>
                      <li>
                        <p>Join the community of 250,000+ technical peers</p>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div> <!-- /container-fluid -->

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-3 sidebartoc">
         <h4><a href="../../">WAF141 1.0</a></h4>
  <p class="caption">
   <span class="caption-text">Current Page</span>
  </p>
  <ul>
<li><a class="reference internal" href="#">Exercise 2.1: Protocol Compliance</a><ul>
<li><a class="reference internal" href="#objective">Objective</a></li>
<li><a class="reference internal" href="#apply-security-policy">Apply Security Policy</a></li>
<li><a class="reference internal" href="#burp-ing-the-app">Burp’ing the App</a></li>
<li><a class="reference internal" href="#http-compliancy-check-enforce-host-header">HTTP Compliancy Check - Enforce Host Header</a></li>
<li><a class="reference internal" href="#learning-and-blocking">Learning and Blocking</a></li>
<li><a class="reference internal" href="#http-compliancy-check-bad-host-header-value">HTTP Compliancy Check - Bad Host Header Value</a></li>
<li><a class="reference internal" href="#http-compliancy-check-multiple-host-headers">HTTP Compliancy Check - Multiple Host Headers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../module2.html"
                        title="previous chapter">Module 2: Transparent Security Policy</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../module3/module3.html"
                        title="next chapter">Module 3: Blocking, Tuning and Attacking the Policy</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/module2/lab1/lab1.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <form class="search" action="../../search.html" method="get">
    <div>
      <input type="text" name="q" placeholder="Search" style="padding-left: 6px;"/>
      <!-- <input type="submit" value="Go" style="margin-top: 4px;"/> -->
      <button type="submit" class="btn btn-primary btn-xs">Go</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        
      </div>
      <div class="col-md-offset-3 col-sm-offset-3 main">
        <h4>
          <a href="/">Cloud Docs Home</a> &gt; <a href="../../index.html">WAF141</a>
          <span class="right"><a href="../../genindex.html">Index</a></span>
        </h4>
        
  <div class="section" id="exercise-2-1-protocol-compliance">
<h1>Exercise 2.1: Protocol Compliance<a class="headerlink" href="#exercise-2-1-protocol-compliance" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Attach the security policy to the appropriate virtual server.</li>
<li>Validate that the security policy is working correctly.</li>
<li>Implement HTTP Protocol Compliancy checks</li>
<li>Explore Learning and Blocking</li>
<li>Get familiar with ASM Event Logs</li>
<li>Estimated time for completion <strong>45</strong> <strong>minutes</strong>.</li>
</ul>
</div>
<div class="section" id="apply-security-policy">
<h2>Apply Security Policy<a class="headerlink" href="#apply-security-policy" title="Permalink to this headline">¶</a></h2>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">To clearly demonstrate just the protocol compliance protection, on the <code class="docutils literal notranslate"><span class="pre">webgoat.f5.demo_https_vs</span></code> virtual server; PLEASE PERFORM THE FOLLOWING TWO STEPS:</p>
</div>
<ol class="arabic simple">
<li>Navigate to the <strong>webgoat.f5.demo_https_vs</strong> virtual, then its <strong>Security</strong> tab.</li>
<li><strong>Remove</strong> the previously created Bot Defense <strong>(webgoat_bot)</strong> profile and bot logging profile <strong>(bot-defense)</strong>.</li>
<li><strong>Enable</strong> the <code class="docutils literal notranslate"><span class="pre">lab1_webgoat_waf</span></code> Security Policy</li>
</ol>
<p>Your virtual should look like this</p>
<a class="reference internal image-reference" href="../../_images/image12.png"><img alt="../../_images/image12.png" src="../../_images/image12.png" style="width: 600px;" /></a>
</div>
<div class="section" id="burp-ing-the-app">
<h2>Burp’ing the App<a class="headerlink" href="#burp-ing-the-app" title="Permalink to this headline">¶</a></h2>
<p>In this section we are going to use the free/community version of an excellent DAST tool; Burp. Unfortunately, the free version does not actually allow DAST but it is still an excellent tool for packet crafting and that’s exactly how we are going to use it.
We will be manually sending two different attack types to demonstrate the protocol compliance features of ASM.</p>
</div>
<div class="section" id="http-compliancy-check-enforce-host-header">
<h2>HTTP Compliancy Check - Enforce Host Header<a class="headerlink" href="#http-compliancy-check-enforce-host-header" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By way of RFC; HTTP/1.1 requires a host header. Many servers will still process the request without one. We want to enforce RFC compliant HTTP.</p>
</div>
<ol class="arabic simple">
<li>Open Burp by clicking the icon in the system tray at the top of the screen. (If it offers an update, please decline)</li>
</ol>
<img alt="../../_images/burp.png" src="../../_images/burp.png" />
<ol class="arabic simple" start="2">
<li>This will be a temporary project so click <strong>next</strong> to proceed and choose “Use Burp Defaults” on the next screen.</li>
<li>Click <strong>Start Burp</strong> and navigate to the <strong>Repeater</strong> tab once opened.</li>
<li>Under the <strong>Request</strong> tab paste in the following http request, remove any whitespace or use the text version on the desktop (go to waf141 folder on Desktop, file is called NoHostHeader.txt), and click <strong>Go</strong>.</li>
</ol>
<p>Attack 1: No Host Header - <strong>Run this 10 times.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">webgoat</span><span class="o">.</span><span class="n">f5</span><span class="o">.</span><span class="n">demo</span><span class="o">/</span><span class="n">WebGoat</span><span class="o">/</span><span class="n">login</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">R2D2</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">38</span>

<span class="n">username</span><span class="o">=</span><span class="n">f5student</span><span class="o">&amp;</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When you copy and paste there may be whitespace in front of the headers. You will need to remove this manually or the request will not be sent. The requests can also be found in txt docs on the client desktop. If you copy and paste from there rather than this site, the whitespace will not be a problem.</p>
</div>
<ol class="arabic simple" start="5">
<li>A popup will appear asking for target details. Fill out the form as shown below.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image101.png"><img alt="../../_images/image101.png" src="../../_images/image101.png" style="width: 600px;" /></a>
<p>Request and Response should look like this</p>
<a class="reference internal image-reference" href="../../_images/image5.png"><img alt="../../_images/image5.png" src="../../_images/image5.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="6">
<li>Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and clear the illegal request filter. You should see these requests being logged as legal but you may want to implement policy per the “Good WAF Protection recommendations”, to not allow this since it is not RFC compliant HTTP/1.1</li>
</ol>
<a class="reference internal image-reference" href="../../_images/image20.png"><img alt="../../_images/image20.png" src="../../_images/image20.png" style="width: 600px;" /></a>
</div>
<div class="section" id="learning-and-blocking">
<h2>Learning and Blocking<a class="headerlink" href="#learning-and-blocking" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings</strong> and look for <strong>HTTP Protocol Compliance failed</strong></li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image1.png"><img alt="../../_images/module2Lab1Excercise3-image1.png" src="../../_images/module2Lab1Excercise3-image1.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="2">
<li>Notice the violation is set to learn only and is not enabled by default in a Rapid Deployment Policy. That is why the request was seen as legal and there was no alert in the event logs.</li>
<li>Since learning <strong>was</strong> on by default there must be a learning suggestion ready for us. Let’s go take a look.</li>
<li>We want to specifically find the learning suggestion for <strong>HTTP protocol compliance failed - HTTP Check: No Host header in HTTP/1.1 request</strong></li>
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Traffic Learning</strong> and click on the search.</li>
<li>In the suggestion section select <strong>HTTP Protocol Compiance</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image2.png"><img alt="../../_images/module2Lab1Excercise3-image2.png" src="../../_images/module2Lab1Excercise3-image2.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="6">
<li>Under the Advanced Tab move the slider to the left so you can see alerts with a learning score of less than 50 and click <strong>Apply Filter</strong></li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image3.png"><img alt="../../_images/module2Lab1Excercise3-image3.png" src="../../_images/module2Lab1Excercise3-image3.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="7">
<li>Note the action ASM is suggesting that you take - <strong>“Enable HTTP Check”</strong>. As in the example, you may ahve multiple suggestion for HTTP Protocol Compliance Failed, they should all be from the burp test.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image4.png"><img alt="../../_images/module2Lab1Excercise3-image4.png" src="../../_images/module2Lab1Excercise3-image4.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="8">
<li>Click <strong>Accept Suggestion</strong> and then browse back to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings &gt; HTTP Protocol Compliance failed</strong> and notice that by accepting the learning suggestion ASM has now enabled the protection but it is still in learning mode so <strong>uncheck</strong> that manually.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image5.png"><img alt="../../_images/module2Lab1Excercise3-image5.png" src="../../_images/module2Lab1Excercise3-image5.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="9">
<li><strong>Be sure you have clicked “Save” and Apply the Policy prior to proceeding.</strong></li>
<li>Go back to <strong>Burp</strong> and run the attack again one or more times.</li>
</ol>
<p>11. Browse to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> on the BIG-IP GUI.
You should now see the alerts since we have enabled this compliancy check and turned off learning.</p>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise3-image6.png"><img alt="../../_images/module2Lab1Excercise3-image6.png" src="../../_images/module2Lab1Excercise3-image6.png" style="width: 600px;" /></a>
</div>
<div class="section" id="http-compliancy-check-bad-host-header-value">
<h2>HTTP Compliancy Check - Bad Host Header Value<a class="headerlink" href="#http-compliancy-check-bad-host-header-value" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Bad Host Header Value</strong> check is an HTTP Parser Attack and definitely something that should be implemented as part of <strong>Good WAF Security</strong>.</p>
<p><strong>Risk:</strong>
If we allow bad host header values they can be used to Fuzz web servers and gather system information. Successful exploitation of this attack could allow for the execution of XSS arbitrary code.</p>
<p>1. Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings &gt; HTTP Protocol Compliance failed</strong> and find <strong>Bad host header value</strong>
Notice that by default this is also in learning mode but disabled by default in a Rapid Deployment Policy.</p>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise4-image1.png"><img alt="../../_images/module2Lab1Excercise4-image1.png" src="../../_images/module2Lab1Excercise4-image1.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li><strong>Uncheck</strong> the Learn box and <strong>Check</strong> the Enable box. Scroll up, click <strong>Save</strong> and <strong>Apply Policy</strong>.</li>
</ol>
<p>3. Go back to <strong>Burp</strong> and under the <strong>Request</strong> tab paste in the following http request, remove any whitespace, or use the text version on the desktop (go to the waf141 folder on the Desktop, file is called BadHostHeader.txt), and click <strong>Go</strong>.
Replace password with the password provided by the instructor.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Attack 2: XSS in HOST Header</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">webgoat</span><span class="o">.</span><span class="n">f5</span><span class="o">.</span><span class="n">demo</span><span class="o">/</span><span class="n">WebGoat</span><span class="o">/</span><span class="n">login</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">BB8</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">38</span>
<span class="n">Host</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">alert</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">cookie</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="n">username</span><span class="o">=</span><span class="n">f5student</span><span class="o">&amp;</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise4-image2.png"><img alt="../../_images/module2Lab1Excercise4-image2.png" src="../../_images/module2Lab1Excercise4-image2.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="4">
<li>Browse to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the alert for this attempted attack. Note the alert severity is much higher (4) for this attack type due to the risk it presents.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise4-image3.png"><img alt="../../_images/module2Lab1Excercise4-image3.png" src="../../_images/module2Lab1Excercise4-image3.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li>Click <strong>Export Request</strong> and review the detailed report. Notice the XSS alerts and how they are currently still in staging. We will cover this in the next module.</li>
</ol>
</div>
<div class="section" id="http-compliancy-check-multiple-host-headers">
<h2>HTTP Compliancy Check - Multiple Host Headers<a class="headerlink" href="#http-compliancy-check-multiple-host-headers" title="Permalink to this headline">¶</a></h2>
<p>Description - Examines requests to ensure that they contain only a single “Host” header.
This is an example of an HTTP Request Smuggling Attack</p>
<p>Risk - An attacker may try to evade security checks by confusing ASM and/or application servers as to which hostname is being accessed.</p>
<p>Example - The website may be accessed by non-browser clients attempting to bypass security gateways.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There will be little guidance on this section. Use what you have learned above to complete this lab. Please ask an instructor if you need help.</p>
</div>
<p><strong>Order of Operations</strong></p>
<ol class="arabic simple">
<li>Disable learning and Enable the Compliancy Check for <strong>Multiple Host Headers</strong> in learning and blocking settings.</li>
<li>Use <strong>BURP</strong> to perform the Attack</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">webgoat</span><span class="o">.</span><span class="n">f5</span><span class="o">.</span><span class="n">demo</span><span class="o">/</span><span class="n">WebGoat</span><span class="o">/</span><span class="n">login</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">BB8</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">38</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">LordVader</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">LukeSkywalker</span>

<span class="n">username</span><span class="o">=</span><span class="n">f5student</span><span class="o">&amp;</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Review Event Logs to ensure the attack is being mitigated. Notice the alert level is lower for this attack type due to less risk than a potential XSS as seen in the previous exercise.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise5-image1.png"><img alt="../../_images/module2Lab1Excercise5-image1.png" src="../../_images/module2Lab1Excercise5-image1.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/module2Lab1Excercise5-image2.png"><img alt="../../_images/module2Lab1Excercise5-image2.png" src="../../_images/module2Lab1Excercise5-image2.png" style="width: 600px;" /></a>
<p><strong>This concludes module 2</strong></p>
</div>
</div>


        
		     <div class="row next-prev-btn-row">
           <div class="col-lg-12">
           
		        <a href="../module2.html" title="Module 2: Transparent Security Policy" accesskey="p" class="btn btn-primary pull-left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
           
           
              <a href="../../module3/module3.html" title="Module 3: Blocking, Tuning and Attacking the Policy" accesskey="n" class="btn btn-primary pull-right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
           
		     </div>
         </div>
        
      </div>
    </div>
  </div>


      <div class="container-fluid">
      <div class="row">
        <div class="content-fluid pre-footer">
          <div class="blocks-container">
            <div class="block">
              <h3>Support Programs</h3>
              <p>Regionally located support centers enable F5 to provide support in a number of languages through native-speaking support engineers.</p>
              <a class="btn internalLink" data-ng-href="https://f5.com/support/support-offerings" target="_blank" href="https://f5.com/support/support-offerings">See more
                <span class="icon-1x-right icon-new-window" data-icon="new-window">​</span>
              </a>
            </div>
            <div class="block">
              <h3>Contact Support</h3>
              <p>
                North America: 1-888-882-7535<br>
                Outside North America: 800-11-275-435
              </p>
              <a class="btn internalLink" data-ng-href="https://f5.com/about-us/contact#regional-support" target="_blank" href="https://f5.com/about-us/contact#regional-support">Local Support Numbers
                <span class="icon-1x-right icon-new-window" data-icon="new-window">​</span>
              </a>
            </div>
            <div class="block">
              <h3>Feedback and Help</h3>
              <p>Have questions, suggestions, or just want to get something off your chest? Let us know.</p>
              <a class="btn" data-ui-sref="siteFeedback" target="_blank" href="https://support.f5.com/csp/siteFeedback">Leave feedback</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="footer">
          <div class="container">
            <div class="col-sm-3 col-md-2">
              <h4>About F5</h4>
              <ul>
                <li><a data-ng-href="https://f5.com/about-us/contact" target="_blank" data-link-type="footer" href="https://f5.com/about-us/contact" class="internalLink">Contact F5</a>
                </li>
                <li><a data-ng-href="https://f5.com/about-us/careers" target="_blank" data-link-type="footer" href="https://f5.com/about-us/careers" class="internalLink">Careers</a>
                </li>
              </ul>
            </div>
            <div class="col-sm-3 col-md-2">
              <h4>Education</h4>
              <ul>
                <li><a data-ng-href="https://f5.com/education/training" target="_blank" data-link-type="footer" href="https://f5.com/education/training" class="internalLink">Training</a>
                </li>
                <li><a data-ng-href="https://f5.com/education/certification" target="_blank" data-link-type="footer" href="https://f5.com/education/certification" class="internalLink">Certification</a>
                </li>
                <li><a data-ng-href="https://f5.com/education/training/free-courses" target="_blank" data-link-type="footer" href="https://f5.com/education/training/free-courses" class="internalLink">Free Online Training</a>
                </li>
              </ul>
            </div>

            <div class="col-sm-3 col-md-2">
              <h4>F5 sites</h4>
              <ul>
              <li><a data-ng-href="https://f5.com" target="_blank" data-link-type="footer" href="https://f5.com" class="internalLink">F5.com</a>
              </li>
              <li><a data-ng-href="https://devcentral.f5.com" target="_blank" data-link-type="footer" href="https://devcentral.f5.com" class="internalLink">Community</a>
              </li>
              <li><a data-ng-href="https://partners.f5.com" target="_blank" data-link-type="footer" href="https://partners.f5.com" class="internalLink">Partners</a>
              </li>
          </ul>
      </div>

      <div class="col-sm-3 col-md-2">
          <h4>Support Tasks</h4>
          <ul>
              <li><a data-ui-sref="mySupport.createServiceRequest" data-link-type="footer" href="https://support.f5.com/csp/my-support/service-request">Create Service Request </a>
              </li>
              <li><a data-ng-href="https://f5.com/about-us/contact#regional-support" target="_blank" data-link-type="footer" href="https://f5.com/about-us/contact#regional-support" class="internalLink">Contact Support</a>
              </li>
              <li><a data-ui-sref="siteFeedback" target="_blank" data-link-type="footer" href="https://support.f5.com/csp/siteFeedback">Leave feedback [+]</a>
              </li>
          </ul>
      </div>

      <div class="col-xs-12 col-md-3 right">
          <h4>Connect with us</h4>
          <ul class="social_icons">
              <li><a href="//twitter.com/f5networks" target="_blank" data-name="twitter" data-type="" data-prefix="social" data-utf="E032" title="Twitter" class="externalLink"><i class="icon-1x icon-twitter icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.linkedin.com/companies/f5-networks" target="_blank" class="linkedin externalLink" title="LinkedIn"><i class="icon-1x icon-linkedin icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.facebook.com/f5networksinc" target="_blank" class="facebook externalLink" title="Facebook"><i class="icon-1x icon-facebook icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a href="//www.youtube.com/f5networksinc" target="_blank" class="youtube externalLink" title="YouTube"><i class="icon-1x icon-youtube icon-inverse-circle" data-link-type="footer"></i></a></li>
              <li><a data-ng-href="https://devcentral.f5.com" target="_blank" class="devcentral internalLink" title="DevCentral" href="https://devcentral.f5.com"><i class="icon-1x icon-dc-pos icon-inverse-circle" data-link-type="footer"></i></a></li>
          </ul>
      </div>

      <div class="content-fluid left">
          <div class="col-xs-12">
              <p>
                  © Copyright <span class="ng-binding">2017</span> by F5 Networks, Inc. |
                  <a data-ng-href="https://f5.com/about-us/policies" target="_blank" data-link-type="footer" href="https://f5.com/about-us/policies" class="internalLink">Policies</a> |
                  <a data-ng-href="https://f5.com/about-us/policies/trademarks" target="_blank" data-link-type="footer" href="https://f5.com/about-us/policies/trademarks" class="internalLink">Trademarks</a>
              </p>
          </div>
      </div>
  </div>
</div>
  </div>
</div>

  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script type="text/javascript">
    jQuery.noConflict(true)
  </script>
  </body>
</html>